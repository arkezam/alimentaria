import{a as U,b as j,c as z,d as $,e as B,f as D,g as W,h as q,j as K,k as G}from"./chunk-VTMQXDHM.js";import{a as R,c as O,h as V,l as k,m as H,n as J}from"./chunk-7UPRQAP3.js";import{l as N,n as L}from"./chunk-ARZNZIPW.js";import{Cb as g,Db as a,Eb as c,Gb as _,Hb as P,Ib as C,Nb as T,Pa as s,R as I,Ua as f,X as w,Za as E,ca as h,cb as v,da as x,e as y,jb as d,kb as M,ob as r,pb as i,rb as A,ub as F,vb as m}from"./chunk-5ON5RGEH.js";var u=y(G()),Q=y(G());var b=class o{http=w(O);cookieService=w(k);API_URL=`${J}/api/usuarios`;COOKIE_NAME="authToken";getAuthHeaders(){let e=this.cookieService.get(this.COOKIE_NAME);return new R({Authorization:`Bearer ${e}`})}registrar(e){return this.http.post(`${this.API_URL}/registrar-cuenta`,e,{headers:this.getAuthHeaders()})}obtenerCuentaPorId(e){return this.http.get(`${this.API_URL}/${e}`,{headers:this.getAuthHeaders()})}actualizarCuenta(e,t){return this.http.put(`${this.API_URL}/${e}`,t,{headers:this.getAuthHeaders()})}eliminarCuenta(e){return this.http.delete(`${this.API_URL}/${e}`,{headers:this.getAuthHeaders()})}actualizarPassword(e,t){let l={nuevoPassword:t};return this.http.put(`${this.API_URL}/${e}/password`,l,{headers:this.getAuthHeaders()})}static \u0275fac=function(t){return new(t||o)};static \u0275prov=I({token:o,factory:o.\u0275fac,providedIn:"root"})};function Z(o,e){o&1&&(r(0,"div"),a(1," La contrase\xF1a es requerida "),i())}function ee(o,e){o&1&&(r(0,"div"),a(1," M\xEDnimo 8 caracteres "),i())}function te(o,e){if(o&1&&(r(0,"div",24),v(1,Z,2,0,"div",25)(2,ee,2,0,"div",25),i()),o&2){m();let t=g(37);s(),d("ngIf",t.errors==null?null:t.errors.required),s(),d("ngIf",t.errors==null?null:t.errors.minlength)}}function re(o,e){o&1&&(r(0,"div",24),a(1," Las contrase\xF1as no coinciden "),i())}function ie(o,e){if(o&1){let t=A();r(0,"div",6)(1,"div",7)(2,"h2",8),a(3," Informaci\xF3n Personal "),i(),r(4,"div",9)(5,"div")(6,"label",10),a(7,"Nombre:"),i(),r(8,"p",11),a(9),i()(),r(10,"div")(11,"label",10),a(12,"Apellido:"),i(),r(13,"p",11),a(14),i()(),r(15,"div")(16,"label",10),a(17,"Email:"),i(),r(18,"p",11),a(19),i()(),r(20,"div")(21,"label",10),a(22,"Rol:"),i(),r(23,"p",11),a(24),i()()()(),r(25,"div",12)(26,"h3",13),a(27,"Cambiar Contrase\xF1a"),i(),r(28,"form",14,1),F("ngSubmit",function(){h(t);let n=m();return x(n.cambiarPassword())}),r(30,"div",9)(31,"div",15)(32,"label",16),a(33," Nueva Contrase\xF1a "),r(34,"span",17),a(35,"*"),i()(),r(36,"input",18,2),C("ngModelChange",function(n){h(t);let p=m();return P(p.nuevaPassword,n)||(p.nuevaPassword=n),x(n)}),i(),v(38,te,3,2,"div",19),i(),r(39,"div",15)(40,"label",20),a(41," Confirmar Contrase\xF1a "),r(42,"span",17),a(43,"*"),i()(),r(44,"input",21,3),C("ngModelChange",function(n){h(t);let p=m();return P(p.confirmPassword,n)||(p.confirmPassword=n),x(n)}),i(),v(46,re,2,0,"div",19),i()(),r(47,"div",22)(48,"button",23),a(49," Actualizar Contrase\xF1a "),i()()()()()}if(o&2){let t=g(29),l=g(37),n=m();s(9),c(n.usuario.nombre),s(5),c(n.usuario.apellido),s(5),c(n.usuario.email),s(5),c(n.usuario.rol),s(12),_("ngModel",n.nuevaPassword),s(2),d("ngIf",l.invalid&&(l.dirty||l.touched)),s(6),M("border-red-300",n.passwordMismatch),_("ngModel",n.confirmPassword),s(2),d("ngIf",n.passwordMismatch),s(2),d("disabled",t.invalid||n.passwordMismatch)}}function ne(o,e){if(o&1&&(r(0,"p",26),a(1),i()),o&2){let t=m();s(),c(t.error)}}var S=class o{constructor(e,t,l,n){this.cuentasService=e;this.perfilesService=t;this.authService=l;this.router=n}usuario=null;error=null;nuevaPassword="";confirmPassword="";ngOnInit(){let e=this.authService.getUserId();e?this.perfilesService.obtenerCuentaPorId(e).subscribe({next:t=>this.usuario=t,error:t=>console.error("Error al obtener el usuario:",t)}):console.warn("No se pudo obtener el ID del usuario"),console.log(e)}cambiarPassword(){if(this.nuevaPassword!==this.confirmPassword){u.default.fire("Error","Las contrase\xF1as no coinciden","error");return}this.nuevaPassword.trim()&&this.cuentasService.actualizarPassword(this.usuario.idUsuario,this.nuevaPassword).subscribe({next:()=>{u.default.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.onmouseenter=u.default.stopTimer,e.onmouseleave=u.default.resumeTimer}}),Q.default.fire({icon:"success",title:"Contrase\xF1a actualizada correctamente",confirmButtonColor:"#8F0202"}),this.router.navigate(["/home"])},error:e=>{u.default.fire("Error","No se pudo actualizar la contrase\xF1a","error"),console.error(e)}})}get passwordMismatch(){return this.nuevaPassword!==this.confirmPassword&&this.confirmPassword!==""}static \u0275fac=function(t){return new(t||o)(f(b),f(b),f(H),f(V))};static \u0275cmp=E({type:o,selectors:[["app-perfil"]],decls:5,vars:2,consts:[["errorTemplate",""],["passwordForm","ngForm"],["newPasswordInput","ngModel"],["confirmPasswordInput","ngModel"],[1,"text-2xl","font-bold","text-gray-800","mb-4"],["class","perfil-container bg-white shadow-md rounded-lg p-6 mx-auto",4,"ngIf","ngIfElse"],[1,"perfil-container","bg-white","shadow-md","rounded-lg","p-6","mx-auto"],[1,"mb-8","border-b","border-gray-200","pb-6"],[1,"text-xl","font-semibold","text-gray-700","mb-4"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"block","text-lg","font-bold","text-gray-600","mb-1"],[1,"text-gray-800"],[1,"mt-6"],[1,"text-lg","font-semibold","text-gray-700","mb-4"],[3,"ngSubmit"],[1,"mb-4"],["for","newPassword",1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-red-500"],["type","password","id","newPassword","name","newPassword","required","","minlength","8",1,"mt-1","block","w-full","border","border-gray-300","rounded-lg","p-2","focus:outline-none","focus:ring-2","focus:ring-amber-500",3,"ngModelChange","ngModel"],["class","text-red-500 text-sm mt-1",4,"ngIf"],["for","confirmPassword",1,"block","text-sm","font-medium","text-gray-700","mb-1"],["type","password","id","confirmPassword","name","confirmPassword","required","",1,"mt-1","block","w-full","border","border-gray-300","rounded-lg","p-2","focus:outline-none","focus:ring-2","focus:ring-amber-500",3,"ngModelChange","ngModel"],[1,"mt-6","flex","justify-end"],["type","submit",1,"bg-[#8f2302]","text-white","px-6","py-2","rounded-lg","hover:bg-[#8F0202]","transition","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[1,"text-red-500","text-sm","mt-1"],[4,"ngIf"],[1,"text-red-600","font-semibold"]],template:function(t,l){if(t&1&&(r(0,"h2",4),a(1,` Perfil de Usuario
`),i(),v(2,ie,50,11,"div",5)(3,ne,2,1,"ng-template",null,0,T)),t&2){let n=g(4);s(2),d("ngIf",l.usuario)("ngIfElse",n)}},dependencies:[L,N,K,D,U,j,z,W,q,B,$],encapsulation:2})};export{S as default};
